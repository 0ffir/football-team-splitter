<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כוחות לכדורגל ברביעי</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f4f4;
            direction: rtl;
        }
        h1 {
            color: #007BFF;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 800px;
        }
        .player-input {
            display: flex;
            flex-direction: column;
            margin: 10px;
            width: calc(50% - 20px);
            background-color: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .player-input select {
            margin-bottom: 5px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .teams {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
        }
        .team {
            border: 1px solid #000;
            background-color: #fff;
            padding: 10px;
            width: 30%;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h3 {
            text-align: center;
            color: #007BFF;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            padding: 5px;
            border-bottom: 1px solid #ccc;
        }
        li:last-child {
            border-bottom: none;
        }
        .team-summary {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>כוחות לכדורגל ברביעי</h1>
    <div class="container" id="playerSelectionContainer">
        <!-- Player selection fields will be dynamically added here -->
    </div>
    <button onclick="splitTeams()">חלק קבוצות</button>
    <button onclick="resetForm()">אפס טופס</button>
    <button onclick="navigateToDatabase()">נהל מאגר שחקנים</button>
    <button onclick="openInNewTab('database.html')">פתח עמוד ניהול מאגר שחקנים בכרטיסייה חדשה</button>
    <div class="teams">
        <div class="team" id="team1">
            <h3>קבוצה 1</h3>
            <ul></ul>
            <div class="team-summary" id="summary1"></div>
        </div>
        <div class="team" id="team2">
            <h3>קבוצה 2</h3>
            <ul></ul>
            <div class="team-summary" id="summary2"></div>
        </div>
        <div class="team" id="team3">
            <h3>קבוצה 3</h3>
            <ul></ul>
            <div class="team-summary" id="summary3"></div>
        </div>
    </div>

    <script>
        const players = [];

        function loadPlayerSelection() {
            const playerSelectionContainer = document.getElementById('playerSelectionContainer');
            playerSelectionContainer.innerHTML = '';
            const playerDatabase = JSON.parse(localStorage.getItem('players')) || [];
            for (let i = 1; i <= 18; i++) {
                const playerInputDiv = document.createElement('div');
                playerInputDiv.className = 'player-input';
                const select = document.createElement('select');
                select.id = `playerSelect${i}`;
                playerDatabase.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.name;
                    option.text = `${player.name} (רמה: ${player.level})`;
                    select.appendChild(option);
                });
                playerInputDiv.appendChild(select);
                playerSelectionContainer.appendChild(playerInputDiv);
            }
        }

        function addPlayers() {
            players.length = 0;
            for (let i = 1; i <= 18; i++) {
                const select = document.getElementById(`playerSelect${i}`);
                const selectedPlayer = select.options[select.selectedIndex].text;
                const playerLevel = selectedPlayer.match(/\(רמה: (\d)\)/)[1];
                players.push({ name: select.value, level: parseInt(playerLevel) });
            }
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function splitTeams() {
            addPlayers();
            if (players.length !== 18) {
                alert('אנא מלא את כל השדות.');
                return;
            }
            shuffle(players);
            players.sort((a, b) => b.level - a.level);
            const teams = [[], [], []];
            for (let i = 0; i < players.length; i++) {
                teams[i % 3].push(players[i]);
            }
            for (let i = 0; i < 3; i++) {
                const teamElement = document.getElementById(`team${i+1}`).querySelector('ul');
                const summaryElement = document.getElementById(`summary${i+1}`);
                teamElement.innerHTML = '';
                let totalLevel = 0;
                teams[i].forEach(player => {
                    const li = document.createElement('li');
                    li.textContent = `${player.name} (רמה: ${player.level})`;
                    teamElement.appendChild(li);
                    totalLevel += player.level;
                });
                const avgLevel = (totalLevel / teams[i].length).toFixed(2);
                summaryElement.textContent = `ממוצע רמה: ${avgLevel}`;
            }
        }

        function resetForm() {
            loadPlayerSelection();
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`team${i}`).querySelector('ul').innerHTML = '';
                document.getElementById(`summary${i}`).textContent = '';
            }
        }

        function navigateToDatabase() {
            window.location.href = 'database.html';
        }

        function openInNewTab(url) {
            window.open(url, '_blank');
        }

        window.onload = loadPlayerSelection;
    </script>
</body>
</html>
